<% layout('layouts/admin/boilerplate') %>
    <link href="/plugins/loaders/custom-loader.css" rel="stylesheet" type="text/css">
    <link href="/plugins/loaders/custom-loader.css" rel="stylesheet" type="text/css">

    <div class="dashboard-content-one">
        <!-- Breadcubs Area Start Here -->
        <div class="breadcrumbs-area">
            <h3>Admins</h3>
            <ul>
                <li>
                    <a href="/admin">Home</a>
                </li>
                <li>view All Admins</li>
            </ul>
        </div>
        <!-- Breadcubs Area End Here -->
        <!-- Class Table Area Start Here -->
        <div class="card height-auto">
            <div class="card-body">
                <div class="heading-layout1">
                    <div class="item-title">
                        <h3>All Admin</h3>
                    </div>
                </div>
                <div class="table-responsive">
                    <table class="table display data-table text-nowrap">
                        <thead>
                            <tr>
                                <th>
                                    ID
                                </th>
                                <th>Name</th>
                                <th>Phone #</th>
                                <th>Address</th>
                                <th>Email</th>
                                <th class="d-none">
                                    Add to homepage</th>
                                <th class="">Edit</th>
                                <th class="d-none">Time</th>
                                <th class="d-none">Phone</th>
                                <th class="d-none">E-mail</th>
                                <th class="d-none"></th>
                            </tr>
                        </thead>
                        <tbody>

                            <% if (allAdmins){ %>
                                <% for (let admin of allAdmins){ %>
                                    <tr>
                                        <td>
                                            <a href="/admin/<%= admin._id %>/view">
                                                <%= admin._id %>
                                            </a>
                                        </td>
                                        <td class="">
                                            <%= admin.userInfo.fullName %>
                                        </td>
                                        <td>
                                            <%= admin.phoneNo %>
                                        </td>
                                        <td>
                                            <%= admin.address %>
                                        </td>
                                        <td>
                                            <%= admin.userInfo.email %>

                                        </td>
                                        <td class="">
                                            <div class="heading-layout1">
                                                <div class="dropdown">
                                                    <a class="dropdown-toggle" href="#" role="button"
                                                        data-toggle="dropdown" aria-expanded="false">...</a>

                                                    <div class="dropdown-menu dropdown-menu-right"
                                                        x-placement="bottom-end"
                                                        style="position: absolute; will-change: transform; top: 0px; left: 0px; transform: translate3d(49px, 51px, 0px);">
                                                        <a class="dropdown-item d-none"
                                                            href="/admin/class/641bed5512a0349df9e2ba28/course/641bed5612a0349df9e2ba33/edit">
                                                            <i class="fas fa-cogs text-dark-pastel-green">
                                                            </i>
                                                            Edit
                                                        </a>
                                                        <button class="dropdown-item deleteAdmin"
                                                            data-id="<%= admin._id %>">
                                                            <svg width="20" viewBox="0 0 1024 1024" class="icon"
                                                                version="1.1" xmlns="http://www.w3.org/2000/svg"
                                                                fill="#000000">
                                                                <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                                                                <g id="SVGRepo_tracerCarrier" stroke-linecap="round"
                                                                    stroke-linejoin="round"></g>
                                                                <g id="SVGRepo_iconCarrier">
                                                                    <path d="M724.3 198H296.1l54.1-146.6h320z"
                                                                        fill="#FAFCFB"></path>
                                                                    <path
                                                                        d="M724.3 216.5H296.1c-6.1 0-11.7-3-15.2-7.9-3.5-5-4.3-11.3-2.2-17L332.8 45c2.7-7.3 9.6-12.1 17.4-12.1h320c7.7 0 14.7 4.8 17.4 12.1l54.1 146.6c2.1 5.7 1.3 12-2.2 17-3.5 4.9-9.2 7.9-15.2 7.9z m-401.6-37h375.1L657.3 69.9H363.1l-40.4 109.6z"
                                                                        fill="#0F0F0F"></path>
                                                                    <path
                                                                        d="M664.3 981.6H339.7c-54.2 0-98.5-43.3-99.6-97.5L223.7 235h572.9l-32.8 651.4c-2.3 53.2-46.1 95.2-99.5 95.2z"
                                                                        fill="#ec2213"></path>
                                                                    <path
                                                                        d="M664.3 995H339.7c-29.7 0-57.8-11.4-79-32.2-21.2-20.8-33.3-48.6-34-78.3L210 221.6h600.7L777.2 887c-2.6 60.5-52.2 108-112.9 108zM237.4 248.3l16 635.5c0.5 22.7 9.7 44 25.9 59.8 16.2 15.9 37.7 24.6 60.4 24.6h324.6c46.3 0 84.2-36.2 86.2-82.5l32.1-637.4H237.4z"
                                                                        fill="#191919"></path>
                                                                    <path
                                                                        d="M827.1 239.5H193.3c-22.2 0-40.4-18.2-40.4-40.4v-2.2c0-22.2 18.2-40.4 40.4-40.4h633.8c22.2 0 40.4 18.2 40.4 40.4v2.2c0 22.2-18.2 40.4-40.4 40.4z"
                                                                        fill="#D39E33"></path>
                                                                    <path
                                                                        d="M826 252.9H194.4c-30.3 0-54.9-24.6-54.9-54.9 0-30.3 24.6-54.9 54.9-54.9H826c30.3 0 54.9 24.6 54.9 54.9s-24.7 54.9-54.9 54.9z m-631.6-83.1c-15.5 0-28.2 12.6-28.2 28.2s12.6 28.2 28.2 28.2H826c15.5 0 28.2-12.6 28.2-28.2 0-15.5-12.6-28.2-28.2-28.2H194.4z"
                                                                        fill="#111111"></path>
                                                                    <path d="M354.6 430.3v369.6" fill="#FAFCFB"></path>
                                                                    <path
                                                                        d="M354.6 813.3c-7.4 0-13.4-6-13.4-13.4V430.3c0-7.4 6-13.4 13.4-13.4s13.4 6 13.4 13.4v369.6c-0.1 7.4-6 13.4-13.4 13.4z"
                                                                        fill="#0F0F0F"></path>
                                                                    <path d="M458.3 430.3v369.6" fill="#FAFCFB"></path>
                                                                    <path
                                                                        d="M458.3 813.3c-7.4 0-13.4-6-13.4-13.4V430.3c0-7.4 6-13.4 13.4-13.4s13.4 6 13.4 13.4v369.6c0 7.4-6 13.4-13.4 13.4z"
                                                                        fill="#0F0F0F"></path>
                                                                    <path d="M562.1 430.3v369.6" fill="#FAFCFB"></path>
                                                                    <path
                                                                        d="M562.1 813.3c-7.4 0-13.4-6-13.4-13.4V430.3c0-7.4 6-13.4 13.4-13.4s13.4 6 13.4 13.4v369.6c-0.1 7.4-6.1 13.4-13.4 13.4z"
                                                                        fill="#0F0F0F"></path>
                                                                    <path d="M665.8 430.3v369.6" fill="#FAFCFB"></path>
                                                                    <path
                                                                        d="M665.8 813.3c-7.4 0-13.4-6-13.4-13.4V430.3c0-7.4 6-13.4 13.4-13.4s13.4 6 13.4 13.4v369.6c0 7.4-6 13.4-13.4 13.4z"
                                                                        fill="#0F0F0F"></path>
                                                                </g>
                                                            </svg>
                                                            Delete
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        </td>
                                        <td class="d-none">02/05/2001</td>
                                        <td class="d-none">10.00 am - 11.30 am</td>
                                        <td class="d-none">+ 123 9988568</td>
                                        <td class="d-none">kazifahim93@gmail.com</td>
                                        <td class="d-none">
                                            <div class="dropdown">
                                                <a href="#" class="dropdown-toggle" data-toggle="dropdown"
                                                    aria-expanded="false">
                                                    <span class="flaticon-more-button-of-three-dots"></span>
                                                </a>
                                                <div class="dropdown-menu dropdown-menu-right">
                                                    <a class="dropdown-item" href="#"><i
                                                            class="fas fa-times text-orange-red"></i>Close</a>
                                                    <a class="dropdown-item" href="#"><i
                                                            class="fas fa-cogs text-dark-pastel-green"></i>Edit</a>
                                                    <a class="dropdown-item" href="#"><i
                                                            class="fas fa-redo-alt text-orange-peel"></i>Refresh</a>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    <% }} %>
                        </tbody>
                    </table>
                </div>
                <div class="col-12 form-group d-flex justify-content-end mt-5">
                    <a href="/admin/add/admin" class="col-6 fw-btn-fill btn-gradient-yellow text-center">Add Admin</a>

                </div>
            </div>
        </div>

    </div>
    <button type="button" class="modal-trigger d-none" id="confirmDelete" data-toggle="modal"
        data-target="#confirmation-modal">
        Confirm Deletion
    </button>

    <div class="d-none">
        <form action="" method="get" id="deleteForm">
            <input type="text" name="adminId" id="adminId">
        </form>
    </div>

    <!-- Delete confirmation Modal -->
    <div class="modal fade" id="confirmation-modal" tabindex="-1" role="dialog" style="display: none;"
        aria-hidden="true">
        <div class="modal-dialog success-modal-content" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">×</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="success-message">
                        <div class="item-icon">
                            <svg width="50" fill="#ff0000" viewBox="0 0 32 32" version="1.1"
                                xmlns="http://www.w3.org/2000/svg">
                                <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                                <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                                <g id="SVGRepo_iconCarrier">
                                    <title>warning</title>
                                    <path
                                        d="M30.555 25.219l-12.519-21.436c-1.044-1.044-2.738-1.044-3.782 0l-12.52 21.436c-1.044 1.043-1.044 2.736 0 3.781h28.82c1.046-1.045 1.046-2.738 0.001-3.781zM14.992 11.478c0-0.829 0.672-1.5 1.5-1.5s1.5 0.671 1.5 1.5v7c0 0.828-0.672 1.5-1.5 1.5s-1.5-0.672-1.5-1.5v-7zM16.501 24.986c-0.828 0-1.5-0.67-1.5-1.5 0-0.828 0.672-1.5 1.5-1.5s1.5 0.672 1.5 1.5c0 0.83-0.672 1.5-1.5 1.5z">
                                    </path>
                                </g>
                            </svg>
                        </div>
                        <h3 class="item-title">Are you sure you wanna delete this admin ?</h3>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" id="processDelete" class="btn-fill-xl text-light bg-red">Delete</button>
                    <button type="button" class="footer-btn bg-dark-low" data-dismiss="modal">Cancel</button>
                </div>
            </div>
        </div>
    </div>


    <!-- add or remove a class from home page -->
    <script>
        for (let input of document.querySelectorAll('.addToHome')) {
            input.addEventListener('change', async function (evt) {
                let parent = this.parentNode;
                if (this.checked) {
                    this.setAttribute('loading', '');
                    try {
                        replaceByLoader(parent)
                        let res = await fetch(`/admin/class/${this.getAttribute('id')}/home?add=true`);
                        reAddcheckBox(parent, this);
                    } catch (err) {
                        console.log(err);
                    }
                } else if (!this.checked) {
                    try {
                        replaceByLoader(parent)
                        let res = await fetch(`/admin/class/${this.getAttribute('id')}/home?add=false`);
                        reAddcheckBox(parent, this);
                    } catch (err) {
                        console.log(err);
                    }
                }
            })

        }

        function replaceByLoader(parent) {
            const loader = '<div id="loader" class="spinner-border text-success  align-self-center loader-sm"> Loading...</div>';
            parent.innerHTML = loader;
        }
        function reAddcheckBox(parent, self) {
            parent.children[0].remove();
            parent.appendChild(self);
        }


    </script>

    <script>
        // Delete Admin
        for (let deleteBtn of document.querySelectorAll('.deleteAdmin')) {
            deleteBtn.addEventListener('click', async function (evt) {
                let id = this.getAttribute('data-id');
                document.getElementById('confirmDelete').click();
                document.getElementById('processDelete').addEventListener('click', async function (evt) {
                    showLoadingBtn(this)
                    document.getElementById('adminId').value = this.getAttribute('data-id');
                    document.getElementById('deleteForm').setAttribute('action', `/admin/${id}/delete`);
                    document.getElementById('deleteForm').submit();
                })
            })
        }

        function showLoadingBtn(self) {
            let loadingBtn = '<div class="spinner-border text-danger  align-self-center loader-lg">Loading...</div>'
            self.parentElement.insertAdjacentHTML('afterbegin', loadingBtn);
            self.remove();
        }
    </script>